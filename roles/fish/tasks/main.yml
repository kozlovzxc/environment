---
- name: Install deps
  action: >
    {{ansible_pkg_mgr}} name={{item}}
  with_items:
    - fish
    - git
  become: yes
  become_user: root
  when: ansible_distribution != 'Ubuntu'

- name: Add deps repos(Ubuntu)
  apt_repository:
    repo: "{{item}}"
    state: present
  with_items:
    - 'ppa:fish-shell/release-2'
    - 'ppa:git-core/ppa'
  become: yes
  become_user: root
  when: ansible_distribution == 'Ubuntu'

- name: Install deps(Ubuntu)
  apt:
    name: "{{item}}"
    state: present
    update_cache: yes
  with_items:
    - fish
    - git
  become: yes
  become_user: root
  when: ansible_distribution == 'Ubuntu'

- name: Clone oh-my-fish
  git: repo=https://github.com/oh-my-fish/oh-my-fish dest=/tmp/omf

- name: Install oh-my-fish
  command: /tmp/omf/bin/install --offline --noninteractive

- name: Install oh-my-fish plugins
  shell: omf install {{item}}
  args:
    executable: /usr/bin/fish
  with_items:
    - fasd

- name: Install oh-my-fish theme
  shell: omf install cbjohnson
  args:
    executable: /usr/bin/fish

- name: Use oh-my-fish theme
  shell: omf theme cbjohnson
  args:
    executable: /usr/bin/fish

- name: set up fish as default shell
  user: name={{ansible_user_id}} shell=/usr/bin/fish
  become: yes
  become_user: root
...
